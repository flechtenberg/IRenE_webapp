{% extends "base.html" %}
{% block content %}
    <h2>Refine Extracted Keywords</h2>
    <form action="{{ url_for('process_refined_keywords') }}" method="post">
        <!-- Display Extracted Keywords with Checkboxes and Weight Inputs -->
        <div class="form-group">
            <label>Include/Exclude Keywords:</label>
            <table class="table table-bordered">
                <thead>
                    <tr>
                        <th>Select</th>
                        <th>Keyword</th>
                        <th>Weight (TF-IDF)</th>
                    </tr>
                </thead>
                <tbody>
                    {% for keyword in keywords %}
                    <tr>
                        <td>
                            <input type="checkbox" name="selected_keywords" value="{{ keyword.word }}" checked>
                        </td>
                        <td>{{ keyword.word }}</td>
                        <td>
                            <input type="number" step="0.01" name="weights[{{ keyword.word }}]" value="{{ keyword.weight }}" min="0">
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        <!-- Add New Keywords -->
        <div class="form-group">
            <label>Add New Keywords:</label>
            <div id="new-keywords">
                <div class="form-row align-items-center mb-2">
                    <div class="col-auto">
                        <input type="text" class="form-control mb-2" name="new_keywords[]" placeholder="Keyword">
                    </div>
                    <div class="col-auto">
                        <input type="number" step="0.01" class="form-control mb-2" name="new_weights[]" placeholder="Weight" min="0">
                    </div>
                </div>
            </div>
            <button type="button" class="btn btn-secondary" onclick="addKeyword()">Add Another Keyword</button>
        </div>
        <!-- Submit Button -->
        <button type="submit" class="btn btn-primary">Start Sampling</button>
    </form>

    <!-- JavaScript to Add New Keyword Fields -->
    <script>
        function addKeyword() {
            const newKeywordsDiv = document.getElementById('new-keywords');
            const newRow = document.createElement('div');
            newRow.className = 'form-row align-items-center mb-2';
            newRow.innerHTML = `
                <div class="col-auto">
                    <input type="text" class="form-control mb-2" name="new_keywords[]" placeholder="Keyword">
                </div>
                <div class="col-auto">
                    <input type="number" step="0.01" class="form-control mb-2" name="new_weights[]" placeholder="Weight" min="0">
                </div>
            `;
            newKeywordsDiv.appendChild(newRow);
        }
    </script>
{% endblock %}
